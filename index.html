        const cumplidos = ramo.prerreq.filter(r => estado[r]);
        if (cumplidos.length < ramo.especiales.alMenos) return false;
      }
      return true;
    }

    function crearMalla() {
      const contenedor = document.getElementById("malla");
      ramos.forEach(ramo => {
        const div = document.createElement("div");
        div.textContent = ramo.nombre + " (" + ramo.creditos + " crÃ©ditos)";
        div.id = ramo.codigo;
        div.classList.add("ramo");

        const actualizaEstado = () => {
          const prereqCumplidos = ramo.prerreq.every(pr => estado[pr]);
          const especialesCumplidas = cumpleEspeciales(ramo);

          div.classList.remove("no-aprobado", "aprobado", "bloqueado");
          if (!prereqCumplidos || !especialesCumplidas) {
            div.classList.add("bloqueado");
          } else if (estado[ramo.codigo]) {
            div.classList.add("aprobado");
          } else {
            div.classList.add("no-aprobado");
          }
        };

        div.onclick = () => {
          if (div.classList.contains("bloqueado")) return;
          estado[ramo.codigo] = !estado[ramo.codigo];
          document.getElementById("creditos").textContent = contarCreditos();
          ramos.forEach(r => document.getElementById(r.codigo)?.dispatchEvent(new Event("estado")));
        };

        div.addEventListener("estado", actualizaEstado);
        contenedor.appendChild(div);
        actualizaEstado();
      });
    }

    crearMalla();
  </script>
</body>
</html>
